- id: '1755254428695'
  alias: "\U0001F3CA\U0001F3FB Piscina - Arranque com excedente FV"
  description: ''
  triggers:
  - entity_id: binary_sensor.piscina_excedente_fv_bomba
    to: 'on'
    for: 00:02:00
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id:
      - switch.bomba_piscina
      - switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1755259008848'
  alias: Piscina - Manual terminou (desligar e sair do override)
  description: ''
  triggers:
  - event_type: timer.finished
    event_data:
      entity_id: timer.piscina_manual
    trigger: event
  conditions: []
  actions:
  - target:
      entity_id:
      - switch.bomba_piscina_switch_0
    action: switch.turn_off
    data: {}
  - target:
      entity_id: input_boolean.piscina_override_manual
    action: input_boolean.turn_off
    data: {}
  mode: single
- id: '1755339332285'
  alias: "\U0001F3CA\U0001F3FB Piscina - Watchdog arranque FV (*/2min) v2"
  description: ''
  triggers:
  - minutes: /2
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.piscina_override_manual
    state: 'off'
  - condition: state
    state: 'off'
    entity_id: switch.bomba_piscina_switch_0
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: state
    entity_id: binary_sensor.piscina_excedente_fv_bomba
    state: 'on'
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id: switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1755339342740'
  alias: "\U0001F3CA\U0001F3FB Piscina - Watchdog arranque FV (*/2min) v2"
  description: ''
  triggers:
  - minutes: /2
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.piscina_override_manual
    state: 'off'
  - condition: state
    state: 'off'
    entity_id: switch.bomba_piscina_switch_0
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: state
    entity_id: binary_sensor.piscina_excedente_fv_bomba
    state: 'on'
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id: switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1755339343598'
  alias: "\U0001F3CA\U0001F3FB Piscina - Watchdog arranque FV (*/2min) v2"
  description: ''
  triggers:
  - minutes: /2
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.piscina_override_manual
    state: 'off'
  - condition: state
    state: 'off'
    entity_id: switch.bomba_piscina_switch_0
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: state
    entity_id: binary_sensor.piscina_excedente_fv_bomba
    state: 'on'
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id: switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1757245016939'
  alias: Piscina - Snapshot 5min
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /5
  conditions: []
  actions:
  - action: camera.snapshot
    metadata: {}
    data:
      filename: '"/config/www/piscina_latest.jpg"'
    target:
      entity_id: camera.eira_hd_stream
  mode: single
- id: '1758640648961'
  alias: Piscina — Estado da cobertura (LLM Vision)
  description: ''
  triggers:
  - entity_id: switch.bomba_piscina_switch_0
    to: 'on'
    for: 00:05:00
    trigger: state
  - minutes: /30
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: switch.bomba_piscina_switch_0
    state: 'on'
  actions:
  - response_variable: llmresp
    data:
      provider: 01K5S60RJSW6MFMB543KEDHE23
      model: gpt-4o-mini
      message: 'Observa esta imagem da piscina e responde apenas com um valor booleano
        para atualizar o sensor alvo: "true" se a COBERTURA estiver FECHADA. "false"
        se a COBERTURA estiver ABERTA. Regras: - Considera fechada apenas se a cobertura
        visivelmente cobre totalmente a lâmina de água. - Se a cobertura estiver a
        meio (a mover) ou houver dúvida, responde "false" (trata como aberta). - Não
        expliques. Não uses outras palavras.

        '
      sensor_entity: input_boolean.piscina_cobertura_fechada
      image_entity:
      - camera.eira_piscina_hd_stream
      max_tokens: 24
      target_width: 768
      include_filename: false
    action: llmvision.data_analyzer
  mode: restart
- id: '1758640655955'
  alias: Piscina — Estado da cobertura (LLM Vision)
  description: ''
  triggers:
  - entity_id: switch.bomba_piscina_switch_0
    to: 'on'
    for: 00:05:00
    trigger: state
  - minutes: /30
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: switch.bomba_piscina_switch_0
    state: 'on'
  actions:
  - response_variable: llmresp
    data:
      provider: 01K5S60RJSW6MFMB543KEDHE23
      model: gpt-4o-mini
      message: 'Observa esta imagem da piscina e responde apenas com um valor booleano
        para atualizar o sensor alvo: "true" se a COBERTURA estiver FECHADA. "false"
        se a COBERTURA estiver ABERTA. Regras: - Considera fechada apenas se a cobertura
        visivelmente cobre totalmente a lâmina de água. - Se a cobertura estiver a
        meio (a mover) ou houver dúvida, responde "false" (trata como aberta). - Não
        expliques. Não uses outras palavras.

        '
      sensor_entity: input_boolean.piscina_cobertura_fechada
      image_entity:
      - camera.eira_piscina_hd_stream
      max_tokens: 24
      target_width: 768
      include_filename: false
    action: llmvision.data_analyzer
  mode: restart
