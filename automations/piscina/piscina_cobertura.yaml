# ======================================================================
# üèä PISCINA
# ======================================================================
# Ficheiro: piscina_cobertura.yaml
# Automa√ß√µes: 1
# √öltima atualiza√ß√£o: 2025-11-11
# Migrado automaticamente - Fase 2
# ======================================================================


- id: piscina_estado_da_cobertura_llm_vision
  alias: Piscina ‚Äî Estado da cobertura (LLM Vision)
  description: Automa√ß√£o do Home Assistant.
  triggers:
  - entity_id: switch.bomba_piscina_switch_0
    to: 'on'
    for: 00:05:00
    trigger: state
  - minutes: /30
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: switch.bomba_piscina_switch_0
    state: 'on'
  actions:
  - response_variable: llmresp
    data:
      provider: 01K5S60RJSW6MFMB543KEDHE23
      model: gpt-4o-mini
      message: 'Observa esta imagem da piscina e responde apenas com um valor booleano para atualizar o sensor alvo: "true" se a COBERTURA estiver FECHADA. "false" se a COBERTURA estiver ABERTA. Regras: - Considera fechada apenas se a cobertura visivelmente cobre totalmente a l√¢mina de √°gua. - Se a cobertura estiver a meio (a mover) ou houver d√∫vida, responde "false" (trata como aberta). - N√£o expliques. N√£o uses outras palavras.'
      sensor_entity: input_boolean.piscina_cobertura_fechada
      image_entity:
      - camera.eira_piscina_hd_stream
      max_tokens: 24
      target_width: 768
      include_filename: false
    action: llmvision.data_analyzer
  mode: restart
