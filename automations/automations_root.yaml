- id: '1755254428695'
  alias: "\U0001F3CA\U0001F3FB Piscina - Arranque com excedente FV"
  description: ''
  triggers:
  - entity_id: binary_sensor.piscina_excedente_fv_bomba
    to: 'on'
    for: 00:02:00
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id:
      - switch.bomba_piscina
      - switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1755259008848'
  alias: Piscina - Manual terminou (desligar e sair do override)
  description: ''
  triggers:
  - event_type: timer.finished
    event_data:
      entity_id: timer.piscina_manual
    trigger: event
  conditions: []
  actions:
  - target:
      entity_id:
      - switch.bomba_piscina_switch_0
    action: switch.turn_off
    data: {}
  - target:
      entity_id: input_boolean.piscina_override_manual
    action: input_boolean.turn_off
    data: {}
  mode: single
- id: '1755339343598'
  alias: "\U0001F3CA\U0001F3FB Piscina - Watchdog arranque FV (*/2min) v2"
  description: ''
  triggers:
  - minutes: /2
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.piscina_override_manual
    state: 'off'
  - condition: state
    state: 'off'
    entity_id: switch.bomba_piscina_switch_0
  - condition: numeric_state
    entity_id: input_number.piscina_filtracao_min_restantes
    above: 0
  - condition: state
    entity_id: binary_sensor.piscina_excedente_fv_bomba
    state: 'on'
  - condition: sun
    after: sunrise
    after_offset: 00:15:00
    before: sunset
    before_offset: -00:15:00
  actions:
  - target:
      entity_id: switch.bomba_piscina_switch_0
    action: switch.turn_on
    data: {}
  mode: single
- id: '1757245016939'
  alias: Piscina - Snapshot 5min
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /5
  conditions: []
  actions:
  - action: camera.snapshot
    metadata: {}
    data:
      filename: '"/config/www/piscina_latest.jpg"'
    target:
      entity_id: camera.eira_hd_stream
  mode: single
- id: '1758640655955'
  alias: Piscina — Estado da cobertura (LLM Vision)
  description: ''
  triggers:
  - entity_id: switch.bomba_piscina_switch_0
    to: 'on'
    for: 00:05:00
    trigger: state
  - minutes: /30
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: switch.bomba_piscina_switch_0
    state: 'on'
  actions:
  - response_variable: llmresp
    data:
      provider: 01K5S60RJSW6MFMB543KEDHE23
      model: gpt-4o-mini
      message: 'Observa esta imagem da piscina e responde apenas com um valor booleano
        para atualizar o sensor alvo: "true" se a COBERTURA estiver FECHADA. "false"
        se a COBERTURA estiver ABERTA. Regras: - Considera fechada apenas se a cobertura
        visivelmente cobre totalmente a lâmina de água. - Se a cobertura estiver a
        meio (a mover) ou houver dúvida, responde "false" (trata como aberta). - Não
        expliques. Não uses outras palavras.

        '
      sensor_entity: input_boolean.piscina_cobertura_fechada
      image_entity:
      - camera.eira_piscina_hd_stream
      max_tokens: 24
      target_width: 768
      include_filename: false
    action: llmvision.data_analyzer
  mode: restart
- id: '1759744993552'
  alias: "\U0001F3CA\U0001F3FB Actualizar Horario Bomba Piscina Noite"
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /30
    hours: /1
  - trigger: state
    entity_id:
    - sensor.bomba_piscina_noite_horario
  conditions:
  - condition: time
    after: '13:00:00'
    before: '21:00:00'
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: "{% set horario = states('sensor.bomba_piscina_noite_horario') %}\n{%
        if horario not in ['unknown', 'unavailable', '', None] %}\n  {{ as_datetime(horario).astimezone().isoformat()
        }}\n{% else %}\n  {{ (now() + timedelta(days=1)).replace(hour=2, minute=0,
        second=0, microsecond=0).isoformat() }}\n{% endif %}"
    target:
      entity_id: input_datetime.horario_piscina_noite
  mode: single
- id: '1759745372670'
  alias: teste2
  description: ''
  triggers:
  - device_id: 2f9c9ea7fbfd91205bab02216a817afb
    domain: button
    entity_id: 526ce22089765dd42cdffef922d73e4f
    type: pressed
    trigger: device
  conditions: []
  actions: []
  mode: single
- id: '1759863163761'
  alias: "\U0001F3E1Botão Sala Portão"
  description: ''
  triggers:
  - device_id: e8a6c706997d87b98183e26e7598ae8b
    domain: shelly
    type: triple
    subtype: button
    trigger: device
  - device_id: d686deeba13232cfa6ab008fa8c80dc0
    domain: bthome
    type: button_2
    subtype: long_press
    trigger: device
  conditions: []
  actions:
  - type: turn_on
    device_id: 2388724c80b9ea53afaf76327d603991
    entity_id: c1d7540c34d2b8b447ad390591bee382
    domain: switch
  mode: single
- id: '1759864348160'
  alias: "[\U0001F3E1] Botão shelly Abrir Portão"
  description: ''
  triggers:
  - device_id: f3ec058f8ec36d128a8eaf0dd7286320
    domain: bthome
    type: button
    subtype: press
    trigger: device
  conditions: []
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.portao
  mode: single
- id: '1759864383684'
  alias: New automation
  description: ''
  triggers:
  - type: changed_states
    device_id: 1fc5080f1934f44e78187d3cef50ff60
    entity_id: c495f1e608ba0783c370be0f0cad7c8f
    domain: switch
    trigger: device
  conditions: []
  actions: []
  mode: single
