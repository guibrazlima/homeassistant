#############################################
# ğŸ“¦ Package: Piscina - CloraÃ§Ã£o TPO por Cobertura
# ğŸ¯ Objetivo: Ajustar tempo de produÃ§Ã£o de cloro baseado no estado da cobertura
# ğŸ“‚ LocalizaÃ§Ã£o: /config/packages/piscina_cloro_tpo.yaml
# ğŸ”— DependÃªncias:
#    - input_boolean.piscina_cobertura_fechada
#    - switch.bomba_piscina_switch_0
#    - switch.piscina_cloro_permitir_producao
# ğŸ“ LÃ³gica: Cobertura aberta = 100% tempo, fechada = 30% tempo (ajustÃ¡vel)
# ğŸ“… Ãšltima atualizaÃ§Ã£o: 2025-11-11
#############################################

# âš ï¸ NOTA: As automaÃ§Ãµes deste package foram movidas para automations.yaml
#    para permitir ediÃ§Ã£o via GUI. Este ficheiro contÃ©m apenas:
#    - input_boolean, input_number, template sensors, etc.
#    Ver: automations.yaml (procurar por '# Package: piscina_cloro_tpo.yaml')
#
input_boolean:
  piscina_cloro_tpo_enable:
    name: Cloro - TPO ativo
    icon: mdi:chart-timeline-variant
input_number:
  piscina_cloro_janela_min:
    name: Cloro - Janela TPO (min)
    min: 5
    max: 60
    step: 5
    initial: 10
    unit_of_measurement: min
  piscina_pct_cobertura_aberta:
    name: Cloro - % com cobertura ABERTA
    min: 0
    max: 100
    step: 1
    initial: 100
    unit_of_measurement: '%'
  piscina_pct_cobertura_fechada:
    name: Cloro - % com cobertura FECHADA
    min: 0
    max: 100
    step: 1
    initial: 30
    unit_of_measurement: '%'
template:
- binary_sensor:
  - name: Piscina - Clorador COMANDO ON
    unique_id: piscina_clorador_comando_on
    state: "{{ is_state('switch.piscina_cloro_permitir_producao','on')\n   and is_state('switch.bomba_piscina_switch_0','on')\
      \ }}\n"
    device_class: running
    delay_on: 00:00:15
    delay_off: 00:00:15
sensor:
- platform: history_stats
  name: Clorador - Horas hoje
  entity_id: binary_sensor.piscina_clorador_comando_on
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0, minute=0, second=0, microsecond=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Clorador - Horas este mÃªs
  entity_id: binary_sensor.piscina_clorador_comando_on
  state: 'on'
  type: time
  start: '{{ now().replace(day=1, hour=0, minute=0, second=0, microsecond=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Clorador - Horas este ano
  entity_id: binary_sensor.piscina_clorador_comando_on
  state: 'on'
  type: time
  start: '{{ now().replace(month=1, day=1, hour=0, minute=0, second=0, microsecond=0)
    }}'
  end: '{{ now() }}'
