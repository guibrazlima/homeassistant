# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SENSORES DE MÃ‰DIA MÃ“VEL PARA OTIMIZAÃ‡ÃƒO PISCINA SOLAR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# Estes sensores suavizam as leituras instantÃ¢neas usando mÃ©dia mÃ³vel
# de 5 minutos, reduzindo oscilaÃ§Ãµes e melhorando estabilidade.
#
# Criado: 2026-02-02
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sensor:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ðŸ“Š MÃ©dia MÃ³vel - ProduÃ§Ã£o Solar (5 minutos)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - platform: statistics
    name: "Solar Power 5min Smooth"
    unique_id: solar_power_5min_smooth
    entity_id: sensor.emoncms_solar
    state_characteristic: mean
    max_age:
      minutes: 5
    sampling_size: 60  # 1 sample a cada 5 segundos = 60 samples em 5min
    precision: 0
    
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ðŸ“Š MÃ©dia MÃ³vel - Consumo Casa (sem bomba, 5 minutos)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - platform: statistics
    name: "House Power 5min Smooth"
    unique_id: house_power_5min_smooth
    entity_id: sensor.emoncms_192_168_1_250_use_no_pool_pump
    state_characteristic: mean
    max_age:
      minutes: 5
    sampling_size: 60
    precision: 0
    
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ðŸ“Š MÃ©dia MÃ³vel - Import/Export NET (5 minutos)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - platform: statistics
    name: "Import Export 5min Smooth"
    unique_id: import_export_5min_smooth
    entity_id: sensor.emoncms_import_export
    state_characteristic: mean
    max_age:
      minutes: 5
    sampling_size: 60
    precision: 0
    
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ðŸ“Š MÃ©dia MÃ³vel - ExportaÃ§Ã£o (5 minutos)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - platform: statistics
    name: "Export Power 5min Smooth"
    unique_id: export_power_5min_smooth
    entity_id: sensor.emoncms_export_power_positive
    state_characteristic: mean
    max_age:
      minutes: 5
    sampling_size: 60
    precision: 0
    
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ðŸŽ¯ Indicador de Qualidade de DecisÃ£o
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Calcula a diferenÃ§a entre valor instantÃ¢neo e mÃ©dia mÃ³vel
  # Valores altos = muita variaÃ§Ã£o = aguardar mais tempo
  - platform: template
    sensors:
      solar_stability_indicator:
        friendly_name: "Indicador Estabilidade Solar"
        unique_id: solar_stability_indicator
        unit_of_measurement: "%"
        icon_template: mdi:chart-line-variant
        value_template: >-
          {% set instant = states('sensor.emoncms_solar')|float(0) %}
          {% set smooth = states('sensor.solar_power_5min_smooth')|float(1) %}
          {% if smooth > 0 %}
            {{ ((abs(instant - smooth) / smooth) * 100)|round(1) }}
          {% else %}
            {{ 0 }}
          {% endif %}
        availability_template: >-
          {{ states('sensor.emoncms_solar') not in ['unknown', 'unavailable'] and
             states('sensor.solar_power_5min_smooth') not in ['unknown', 'unavailable'] }}
        attribute_templates:
          classification: >-
            {% set pct = states('sensor.solar_stability_indicator')|float(0) %}
            {% if pct < 5 %}Muito EstÃ¡vel
            {% elif pct < 15 %}EstÃ¡vel
            {% elif pct < 30 %}VariÃ¡vel
            {% else %}Muito VariÃ¡vel
            {% endif %}
          recommendation: >-
            {% set pct = states('sensor.solar_stability_indicator')|float(0) %}
            {% if pct < 15 %}
              Ã“timo momento para decisÃµes
            {% elif pct < 30 %}
              Aguardar mais 2-3 minutos
            {% else %}
              CondiÃ§Ãµes muito instÃ¡veis, aguardar
            {% endif %}
