# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SENSORES DE MÃ‰DIA MÃ“VEL PARA OTIMIZAÃ‡ÃƒO PISCINA SOLAR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# Estes sensores suavizam as leituras instantÃ¢neas usando mÃ©dia mÃ³vel
# de 5 minutos, reduzindo oscilaÃ§Ãµes e melhorando estabilidade.
#
# Criado: 2026-02-02
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“Š MÃ©dia MÃ³vel - ProduÃ§Ã£o Solar (5 minutos)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- platform: statistics
  name: "Solar Power 5min Smooth"
  unique_id: solar_power_5min_smooth
  entity_id: sensor.emoncms_solar
  state_characteristic: mean
  max_age:
    minutes: 5
  sampling_size: 60
  precision: 0

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“Š MÃ©dia MÃ³vel - Consumo Casa (sem bomba, 5 minutos)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- platform: statistics
  name: "House Power 5min Smooth"
  unique_id: house_power_5min_smooth
  entity_id: sensor.emoncms_192_168_1_250_use_no_pool_pump
  state_characteristic: mean
  max_age:
    minutes: 5
  sampling_size: 60
  precision: 0

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“Š MÃ©dia MÃ³vel - Import/Export NET (5 minutos)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- platform: statistics
  name: "Import Export 5min Smooth"
  unique_id: import_export_5min_smooth
  entity_id: sensor.emoncms_import_export
  state_characteristic: mean
  max_age:
    minutes: 5
  sampling_size: 60
  precision: 0

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“Š MÃ©dia MÃ³vel - ExportaÃ§Ã£o (5 minutos)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- platform: statistics
  name: "Export Power 5min Smooth"
  unique_id: export_power_5min_smooth
  entity_id: sensor.emoncms_export_power_positive
  state_characteristic: mean
  max_age:
    minutes: 5
  sampling_size: 60
  precision: 0

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ¯ INDICADOR DE ESTABILIDADE SOLAR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- platform: template
  sensors:
    solar_stability_indicator:
      friendly_name: "Solar Stability Indicator"
      unique_id: solar_stability_indicator
      unit_of_measurement: "%"
      icon_template: >
        {% set pct = state_attr('sensor.solar_stability_indicator', 'variation_percent')|float(0) %}
        {% if pct < 5 %}
          mdi:chart-line
        {% elif pct < 15 %}
          mdi:chart-line-variant
        {% elif pct < 30 %}
          mdi:chart-timeline-variant
        {% else %}
          mdi:chart-scatter-plot
        {% endif %}
      value_template: >
        {% set instant = states('sensor.emoncms_solar')|float(0) %}
        {% set smooth = states('sensor.solar_power_5min_smooth')|float(0) %}
        {% if smooth > 50 %}
          {{ (((instant - smooth)|abs / smooth) * 100)|round(1) }}
        {% else %}
          0
        {% endif %}
      attribute_templates:
        instant_value: "{{ states('sensor.emoncms_solar')|float(0)|round(0) }}"
        smooth_value: "{{ states('sensor.solar_power_5min_smooth')|float(0)|round(0) }}"
        difference: "{{ (states('sensor.emoncms_solar')|float(0) - states('sensor.solar_power_5min_smooth')|float(0))|round(0) }}"
        variation_percent: >
          {% set instant = states('sensor.emoncms_solar')|float(0) %}
          {% set smooth = states('sensor.solar_power_5min_smooth')|float(0) %}
          {% if smooth > 50 %}
            {{ (((instant - smooth)|abs / smooth) * 100)|round(1) }}
          {% else %}
            0
          {% endif %}
        classification: >
          {% set pct = state_attr('sensor.solar_stability_indicator', 'variation_percent')|float(0) %}
          {% if pct < 5 %}
            Muito EstÃ¡vel
          {% elif pct < 15 %}
            EstÃ¡vel
          {% elif pct < 30 %}
            InstÃ¡vel
          {% else %}
            Muito InstÃ¡vel
          {% endif %}
        recommendation: >
          {% set pct = state_attr('sensor.solar_stability_indicator', 'variation_percent')|float(0) %}
          {% if pct < 5 %}
            âœ… CondiÃ§Ãµes Ã³timas para decisÃµes
          {% elif pct < 15 %}
            âœ… CondiÃ§Ãµes boas para decisÃµes
          {% elif pct < 30 %}
            âš ï¸ Aguardar estabilizaÃ§Ã£o (2-3min)
          {% else %}
            ðŸ”´ Evitar decisÃµes - alta variaÃ§Ã£o
          {% endif %}
