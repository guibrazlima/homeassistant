# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SENSOR DE AJUSTE CLIMÃTICO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Ajusta delays da blueprint baseado em previsÃ£o meteorolÃ³gica
#
# Multiplicador aplicado aos delays:
# - Ensolarado: 0.8Ã— (mais agressivo, solar estÃ¡vel)
# - Nublado: 1.2Ã— (mais conservador)
# - Chuva: 2.0Ã— (muito conservador, solar imprevisÃ­vel)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- platform: template
  sensors:
    piscina_weather_delay_multiplier:
      friendly_name: "Multiplicador Delay Meteorologia"
      unique_id: piscina_weather_delay_multiplier
      unit_of_measurement: "Ã—"
      icon_template: >
        {% set condition = states('sensor.realtime_condition') %}
        {% if condition in ['sunny', 'clear'] %}
          mdi:weather-sunny
        {% elif condition in ['partlycloudy', 'cloudy'] %}
          mdi:weather-cloudy
        {% elif condition in ['rainy', 'pouring'] %}
          mdi:weather-rainy
        {% else %}
          mdi:weather-partly-cloudy
        {% endif %}
      value_template: >
        {% if is_state('input_boolean.piscina_use_weather_forecast', 'off') %}
          1.0
        {% else %}
          {% set condition = states('sensor.realtime_condition') %}
          {% if condition in ['sunny', 'clear'] %}
            0.8
          {% elif condition in ['partlycloudy'] %}
            1.0
          {% elif condition in ['cloudy'] %}
            1.2
          {% elif condition in ['rainy', 'pouring'] %}
            2.0
          {% else %}
            1.0
          {% endif %}
        {% endif %}
      attribute_templates:
        weather_condition: "{{ states('sensor.realtime_condition') }}"
        adjustment_enabled: "{{ is_state('input_boolean.piscina_use_weather_forecast', 'on') }}"
        recommendation: >
          {% set condition = states('sensor.realtime_condition') %}
          {% if is_state('input_boolean.piscina_use_weather_forecast', 'off') %}
            âšª Ajuste desativado
          {% elif condition in ['sunny', 'clear'] %}s
            âœ… Solar estÃ¡vel - delays reduzidos (-20%)
          {% elif condition in ['partlycloudy'] %}
            âœ… CondiÃ§Ãµes normais - sem ajuste
          {% elif condition in ['cloudy'] %}
            âš ï¸ Nublado - delays aumentados (+20%)
          {% elif condition in ['rainy', 'pouring'] %}
            ğŸ”´ Chuva - delays duplicados (+100%)
          {% else %}
            âœ… CondiÃ§Ãµes normais - sem ajuste
          {% endif %}
