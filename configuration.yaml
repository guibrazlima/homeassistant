homeassistant:
  customize: !include customize.yaml
  packages:
    aqs_common: !include packages/aqs_common.yaml
    aqs_hp90: !include packages/aqs_hp90_estimador_termico.yaml
    aqs_perdas: !include packages/aqs_perdas.yaml
    climate_comfort: !include packages/climate_comfort_monolitico.yaml
    inputs_common: !include packages/inputs_common.yaml
    piscina_clorador_sal: !include packages/piscina_clorador_sal.yaml
    piscina_cloro_tpo: !include packages/piscina_cloro_tpo.yaml
    piscina_cobertura: !include packages/piscina_cobertura.yaml
    piscina_ph: !include packages/piscina_ph.yaml
    thermal_comfort: !include_dir_merge_named packages/thermal_comfort/


# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Dashboards personalizados
lovelace:
  mode: storage
  dashboards:
    piscina-solar:
      mode: yaml
      title: Piscina Solar
      icon: mdi:solar-power-variant
      show_in_sidebar: true
      filename: lovelace/piscina_solar_dashboard.yaml

#auth_header:
#  username_header: X-authentik-username


#auth_oidc:
#  client_id: "homeassistant"
#  client_secret: !secret client_secret_authentik
#  discovery_url: "https://authentik.moutas.casa/application/o/home-assistant/.well-known/openid-configuration"
#  features:
#    automatic_user_linking: true

recorder:
  db_url: !secret mariadb_connection
  purge_keep_days: 31
  commit_interval: 5
  auto_purge: true

# Configuração de logs com rotação automática
logger:
  default: info
  logs:
    homeassistant.core: warning
    homeassistant.components.recorder: warning
    homeassistant.components.automation: debug
    custom_components.pyscript.file.pv_excess_control: INFO
    custom_components.llmvision: debug
    #custom_components.auth_header: debug

# Rotação de logs - arquivo será mantido em tamanho controlado
# O Home Assistant gerencia automaticamente via logger
# Logs antigos são movidos para .log.1, .log.2, etc.

history:

influxdb:
  api_version: 2
  ssl: false
  host: influxdb
  port: 8086
  token: !secret influxdb_token
  organization: gl
  bucket: homeassistant
  tags:
    source: HomeAssistant
  tags_attributes:
    - friendly_name
  default_measurement: units
  ignore_attributes:
    - icon
  exclude:    # Customise to fit your needs
    entities:
      - zone.home
    domains:
      - persistent_notification
      - person

# Text to speech
tts:
  - platform: google_translate

group: !include groups.yaml
automation: !include automations.yaml
script: !include_dir_merge_named scripts/
# scene: !include scenes.yaml  # Comentado - arquivo vazio removido
sensor: !include_dir_merge_list sensors/
# Inputs consolidados movidos para packages/inputs_common.yaml
# input_select: !include input_select.yaml
# input_number: !include input_number.yaml
# input_boolean: !include input_boolean.yaml
# input_datetime: !include input_datetime.yaml
switch: !include switches.yaml
binary_sensor: !include binary_sensor.yaml
cover: !include cover.yaml
template: !include_dir_merge_list templates/
ingress: !include ingress.yaml
# thermal_comfort: !include thermal_comfort.yaml  # Movido para packages/thermal_comfort/
# A nova estrutura modular está em packages/thermal_comfort/ (exterior, utilidade, comum, quartos)
# Backup original: backups/old_configs/thermal_comfort.yaml.backup
# input_datetime movido para packages/inputs_common.yaml

http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 172.0.0.0/8
    - 192.168.1.0/24

# Telegram Bot - Migrado para UI (integrations)
# NOTA: Adicionar integração "Telegram Bot" via:
# Configurações → Dispositivos e Serviços → Adicionar Integração → Telegram Bot
# API Key: (usar telegram_bot_api_key do secrets.yaml)
# Allowed Chat IDs: 5258104860

# Notifier
notify:
  - platform: telegram
    name: "Gui"
    chat_id: 45258104860

timer:
  piscina_manual:
    name: Piscina — Temporizador manual
    duration: "00:00:00"

#rest_command:
#  cfos_disable_charging:
#    url: !secret cfos_disable_url

#  cfos_enable_charging:
#    url: !secret cfos_enable_url
